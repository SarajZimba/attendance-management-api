<!-- admin.html -->
<h2>Users</h2>
<form id="addUserForm">
  Name: <input type="text" id="name" required>
  Email: <input type="email" id="email" required>
  Password: <input type="password" id="password" required>  <!-- new field -->
  Role: 
  <select id="role">
    <option>EMPLOYEE</option>
    <option>ADMIN</option>
  </select>
  <button type="submit">Add User</button>
</form>


<table id="usersTable" border="1">
  <thead><tr><th>ID</th><th>Name</th><th>Email</th><th>Role</th><th>Active</th></tr></thead>
  <tbody></tbody>
</table>


<h2>Daily Attendance Report</h2>
Date: <input type="date" id="reportDate">
<button id="fetchReport">Fetch Report</button>

<table id="reportTable" border="1">
  <thead>
    <tr>
      <th>User ID</th><th>Name</th><th>Check In</th><th>Check Out</th><th>Late</th><th>Duration (min)</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>
<script>
async function fetchUsers() {
  const res = await fetch("/users/");
  const users = await res.json();
  const tbody = document.querySelector("#usersTable tbody");
  tbody.innerHTML = "";
  users.forEach(u => {
    tbody.innerHTML += `<tr>
      <td>${u.id}</td><td>${u.name}</td><td>${u.email}</td><td>${u.role}</td><td>${u.is_active}</td>
    </tr>`;
  });
}

document.getElementById("addUserForm").addEventListener("submit", async (e) => {
  e.preventDefault();
  const name = document.getElementById("name").value;
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;  // new
  const role = document.getElementById("role").value;

  await fetch("/users/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, email, password, role })
  });

  fetchUsers();  // refresh table
});


// -------------------- REPORT --------------------
document.getElementById("fetchReport").addEventListener("click", async () => {
  const date = document.getElementById("reportDate").value;
  const url = date ? `/reports/daily?date=${date}` : "/reports/daily";
  const res = await fetch(url);
  const report = await res.json();

  const tbody = document.querySelector("#reportTable tbody");
  tbody.innerHTML = "";

  report.forEach(r => {
    tbody.innerHTML += `<tr>
      <td>${r.user_id}</td>
      <td>${r.user_name}</td>
      <td>${r.check_in ? new Date(r.check_in).toLocaleTimeString() : "-"}</td>
      <td>${r.check_out ? new Date(r.check_out).toLocaleTimeString() : "-"}</td>
      <td>${r.is_late ? "Yes" : "No"}</td>
      <td>${r.duration_minutes ?? "-"}</td>
    </tr>`;
  });
});
fetchUsers();
</script>
